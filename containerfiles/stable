FROM registry.playtron.one/internal/playtronos:1.2-stable-base

# Set OS version
COPY rootfs/usr/lib/os-release-playtron /usr/lib/

# Increased open file limits to (1) match the system service and (2) to fix gamescope-dbus issues
COPY rootfs/usr/lib/systemd/user/dbus-broker.service.d/50-playtron.conf			/usr/lib/systemd/user/dbus-broker.service.d/

# Update packages
RUN dnf5 -y upgrade \
  grid-1.33.5 \
  inputplumber-0.75.0 \
  plugin-egs-1.2.4 \
  playserve-1.22.0 \
  powerstation-0.8.1

# Clear cache.
RUN dnf5 clean all && \
  rm -r -f \
    /boot/.vmlinuz*.hmac \
    /var/cache/*

# View final packages.
RUN rpm -qa | sort

# View how well we adhere to bootc best practices.
RUN bootc container lint --no-truncate
